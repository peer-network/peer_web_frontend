async function likeComment(e){const t=getCookie("authToken"),n=new Headers({"Content-Type":"application/json",Authorization:`Bearer ${t}`});var o=JSON.stringify({query:`mutation LikeComment {\n            likeComment(commentid: "${e}") {\n                status\n                ResponseCode\n            }\n        }`,variables:{}}),r={method:"POST",headers:n,body:o,redirect:"follow"};return fetch(GraphGL,r).then(e=>e.json()).then(e=>{if(console.log(e),"error"==e.data.likeComment.status)throw new Error(e.data.likeComment.ResponseCode);return!0}).catch(e=>(Merror("Like failed",e),console.log("error",e),!1))}async function createComment(e,t,n=null){if(!await LiquiudityCheck(3,"Comment Post","comment"))return!1;const o=getCookie("authToken"),r=new Headers({"Content-Type":"application/json",Authorization:`Bearer ${o}`}),a="\n    mutation CreateComment($postId: ID!, $content: String!, $parentId: ID) {\n      createComment(action: COMMENT, postid: $postId, content: $content, parentid: $parentId) {\n        status\n        counter\n        ResponseCode\n        affectedRows {\n          commentid\n          userid\n          content\n          createdat\n          amountlikes\n          isliked\n          postid\n          parentid\n          user {\n              id\n              username\n              slug\n              img\n              isfollowed\n              isfollowing\n          }\n        }\n      }\n    }\n  ",s={postId:e,content:t,parentId:n};return fetch(GraphGL,{method:"POST",headers:r,body:JSON.stringify({query:a,variables:s})}).then(e=>e.json()).then(e=>(console.log("Antwort:",e),e)).catch(e=>(console.error("Fehler:",e),e))}async function fetchChildComments(e){const t=getCookie("authToken"),n=new Headers({"Content-Type":"application/json",Authorization:`Bearer ${t}`}),o="\n  query listChildComments($parent: ID!) {\n    listChildComments(parent: $parent) {\n        status\n        counter\n        ResponseCode\n        affectedRows {\n            commentid\n            userid\n            postid\n            parentid\n            content\n            amountlikes\n            isliked\n            createdat\n            user {\n                id\n                username\n                img\n                isfollowed\n                isfollowing\n            }\n        }\n    }\n  }",r={parent:e};return fetch(GraphGL,{method:"POST",headers:n,body:JSON.stringify({query:o,variables:r})}).then(e=>e.json()).then(e=>{if(console.log("Antwort vom Server:",e),"error"===e.data.listChildComments.status&&"This is not a commentId"!==e.data.listChildComments.ResponseCode)throw new Error(e.data.listChildComments.ResponseCode);return e.data.listChildComments.affectedRows}).catch(e=>(console.error("Fehler:",e),null))}function getCookie(e){const t=`; ${document.cookie}`,n=t.split(`; ${e}=`);if(2===n.length)return n.pop().split(";").shift()}function createModal({title:e="",message:t="",buttons:n=[],type:o="info",textarea:r=!1}){function a(e){e.classList.add("modal-fade-out"),setTimeout(()=>{e.innerHTML="",e.remove()},300)}return new Promise(s=>{const i=document.createElement("div");i.classList.add("modal-container"),i.innerHTML=`\n            <div class="modal-content ${o}">\n                <span class="modal-close">&times;</span>\n                <h2 class="modal-title">${e}</h2>\n                <p class="modal-message">${t}</p>\n                ${r?`<textarea class="modal-textarea" placeholder="${"object"==typeof r&&r.placeholder?r.placeholder:""}">${"object"==typeof r&&r.value?r.value:""}</textarea>`:""}\n                <div class="modal-buttons">\n                    ${n.map((e,t)=>`<button class="modal-button" data-index="${t}">${e}</button>`).join("")}\n                </div>\n            </div>\n        `,document.body.appendChild(i),setTimeout(()=>i.classList.add("modal-show"),10);const l=i.querySelectorAll(".modal-button");l.forEach(e=>{e.addEventListener("click",e=>{const t=e.target.getAttribute("data-index"),n=i.querySelector(".modal-textarea");s(n?{button:Number(t),value:n.value}:Number(t)),a(i)})});const c=i.querySelector(".modal-close");c.addEventListener("click",()=>{s(null),a(i)}),i.addEventListener("click",e=>{e.target===i&&(s(null),a(i))});const d=document.querySelector(".modal-content textarea");d&&setTimeout(()=>{d.focus()},10)})}function userfriendlymsg(e){let t;return t=e in responsecodes.data?responsecodes.data[e].userFriendlyComment:e,t}function info(e,t=""){return createModal({title:e,message:userfriendlymsg(t),buttons:["OK"],type:"info"})}function Merror(e,t=""){return createModal({title:e,message:userfriendlymsg(t),buttons:["OK"],type:"error"})}function warnig(e,t=""){return createModal({title:e,message:userfriendlymsg(t),buttons:["OK"],type:"warning"})}function confirm(e,t=""){return createModal({title:e,message:userfriendlymsg(t),buttons:["Cancel","Confirm"],type:"warning"})}function setScrollPercent(e,t,n=!1){const o=Math.min(100,Math.max(0,t)),r=e.scrollHeight-e.clientHeight,a=r*(o/100);n?e.scrollTo({top:a,behavior:"smooth"}):e.scrollTop=a}function formatNumber(e){return e>=1e6?(e/1e6).toFixed(1).replace(/\.0$/,"")+"M":e>=1e3?(e/1e3).toFixed(1).replace(/\.0$/,"")+"K":e.toString()}function sanitizeString(e){return e.replace(/[^A-Za-z0-9 \-_]/g,"")}function extractAfterComma(e){return e.includes(",")?e.split(",")[1]:e}async function loadTextFile(e,t){try{const n=await fetch(e),o=await n.text();t.innerText=o}catch(e){t.innerText="Fehler beim Laden der Datei."}}function sliceTextAtWord(e,t=140){if(e.length<=t)return e;const n=e.slice(0,t),o=n.lastIndexOf(" ");return n.slice(0,o)}async function readBytes(e,t){try{const n=await fetch(e),o=n.body.getReader(),{value:r,done:a}=await o.read();if(a)return;const s=r.slice(0,t),i=new TextDecoder("utf-8").decode(s);return i}catch(e){console.error("Fehler beim Lesen der Datei:",e)}}function formatDate(e){const t=new Date(e),n={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1};return t.toLocaleString("de-DE",n).replace(",","").replace(/\./g,".")}function timeAgo(e){const t=Date.now(),n=new Date(adjustForDSTAndFormat(e)),o=t-n-36e5,r=Math.floor(o/1e3),a=Math.floor(r/60),s=Math.floor(a/60),i=Math.floor(s/24),l=Math.floor(i/7),c=Math.floor(i/30),d=Math.floor(i/365);return r<60?`${r} second`+(r>1?"s ago":" ago"):a<60?`${a} minute`+(a>1?"s ago":" ago"):s<24?`${s} hour`+(s>1?"s ago":" ago"):i<7?`${i} day`+(i>1?"s ago":" ago"):l<4?`${l} week`+(l>1?"s ago":" ago"):c<12?`${c} month`+(c>1?"s ago":" ago"):`${d} year`+(d>1?"s ago":" ago")}function adjustForDSTAndFormat(e){const t={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1},n=new Date(e.replace(" ","T")),o=new Date(n.getFullYear(),0,1),r=new Date(n.getFullYear(),6,1),a=Math.max(o.getTimezoneOffset(),r.getTimezoneOffset())!==n.getTimezoneOffset();return n.setHours(n.getHours()+1),a&&n.setHours(n.getHours()+1),n.toLocaleString(void 0,t).replace(",","").replace(/\./g,".")}function tempMedia(e){const t=domain.replace("://","://media.")+e;return t}async function fetchHelloData(e=null){const t=getCookie("authToken"),n=new Headers({"Content-Type":"application/json",Authorization:`Bearer ${t}`});let o=JSON.stringify({query:`query Hello {\n      hello {\n          currentuserid\n      }\n      getProfile(userid: ${e}) {\n        status\n        ResponseCode\n        affectedRows {\n            id\n            username\n            status\n            slug\n            img\n            biography\n            isfollowed\n            isfollowing\n            amountposts\n            amounttrending\n            amountfollowed\n            amountfollower\n            amountfriends\n            amountblocked\n        }\n      }\n    }`,variables:{}});var r={method:"POST",headers:n,body:o,redirect:"follow"};try{const e=await fetch(GraphGL,r),t=await e.json();return console.log(t),t}catch(e){throw console.log("error",e),e}}async function hello(){const e=getCookie("authToken"),t=new Headers({"Content-Type":"application/json",Authorization:`Bearer ${e}`}),n=JSON.stringify({query:"query Hello {\n      hello {\n          currentuserid\n      }\n  }"}),o={method:"POST",headers:t,body:n,redirect:"follow"};try{const e=await fetch(GraphGL,o),t=await e.json();if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);if(t.errors)throw new Error(t.errors[0].message);return document.cookie=`userID=${t.data.hello.currentuserid}; path=/; secure; SameSite=Strict`,t.data.hello}catch(e){throw console.error("Error:",e.message),e}}async function getUser(){const e=await fetchHelloData(),t=getCookie("userID");if(t){document.getElementById("username").innerText=e.data.getProfile.affectedRows.username,document.getElementById("slug").innerText="#"+e.data.getProfile.affectedRows.slug,document.getElementById("userPosts").innerText=e.data.getProfile.affectedRows.amountposts,document.getElementById("followers").innerText=e.data.getProfile.affectedRows.amountfollower,document.getElementById("following").innerText=e.data.getProfile.affectedRows.amountfollowed;const t=document.getElementById("profilbild");t.onerror=function(){this.src="svg/noname.svg"},t.src=e.data.getProfile.affectedRows.img?tempMedia(e.data.getProfile.affectedRows.img.replace("media/","")):"svg/noname.svg"}else{const e=document.getElementById("profil-container"),t=document.getElementById("profil-login");e.classList.add("none"),t.classList.remove("none")}return e}let domain=document.getElementById("config").dataset.host;const GraphGL=domain+"/graphql";let responsecodes=[];fetch("./json/response-codes.json").then(e=>e.json()).then(e=>{responsecodes=e,console.log(responsecodes)});
